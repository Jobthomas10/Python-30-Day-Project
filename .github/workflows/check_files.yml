name: Auto Close Issues Based on Files

on:
  push:
    paths:
      - 'Day-*/**/*'  # Monitor any file added/modified in any Day folder

jobs:
  check_files:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Count files in Day folder
        id: file_count
        run: |
          # Get the number of files in the folder
          folder="Day-${GITHUB_REF#refs/heads/}"  # Get the folder name based on the branch (e.g., 'Day-1')
          file_count=$(find "$folder" -type f | wc -l)
          echo "Number of files in $folder: $file_count"
          echo "file_count=$file_count" >> $GITHUB_ENV

      - name: Close the issue if 5 or more files exist
        if: env.file_count >= 5
        run: |
          # Get the issue number based on the folder (Day-1 -> #1)
          issue_number=$((GITHUB_REF_NAME#refs/heads/ | grep -o '[0-9]'))
          
          # Close the issue using GitHub API
          curl -X PATCH -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d '{"state": "closed"}' \
            "https://api.github.com/repos/${{ github.repository }}/issues/${issue_number}"
